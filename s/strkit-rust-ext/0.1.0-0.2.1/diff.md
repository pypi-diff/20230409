# Comparing `tmp/strkit_rust_ext-0.1.0.tar.gz` & `tmp/strkit_rust_ext-0.2.1.tar.gz`

## Comparing `strkit_rust_ext-0.1.0.tar` & `strkit_rust_ext-0.2.1.tar`

### file list

```diff
@@ -1,10 +1,11 @@
--rw-r--r--   0        0        0      255 1970-01-01 00:00:00.000000 strkit_rust_ext-0.1.0/Cargo.toml
--rw-r--r--   0     1001      123     2781 2023-04-08 12:52:05.000000 strkit_rust_ext-0.1.0/.github/workflows/build-release.yml
--rw-r--r--   0     1001      123      685 2023-04-08 12:52:05.000000 strkit_rust_ext-0.1.0/.gitignore
--rw-r--r--   0     1001      123    35149 2023-04-08 12:52:05.000000 strkit_rust_ext-0.1.0/LICENSE
--rw-r--r--   0     1001      123      244 2023-04-08 12:52:05.000000 strkit_rust_ext-0.1.0/README.md
--rw-r--r--   0     1001      123      377 2023-04-08 12:52:05.000000 strkit_rust_ext-0.1.0/pyproject.toml
--rw-r--r--   0     1001      123     1578 2023-04-08 12:52:05.000000 strkit_rust_ext-0.1.0/src/lib.rs
--rw-r--r--   0     1001      123      382 2023-04-08 12:52:05.000000 strkit_rust_ext-0.1.0/strkit_rust_ext.pyi
--rw-r--r--   0     1001      123     7659 2023-04-08 12:52:05.000000 strkit_rust_ext-0.1.0/Cargo.lock
--rw-r--r--   0        0        0      600 1970-01-01 00:00:00.000000 strkit_rust_ext-0.1.0/PKG-INFO
+-rw-r--r--   0        0        0      255 1970-01-01 00:00:00.000000 strkit_rust_ext-0.2.1/Cargo.toml
+-rw-r--r--   0     1001      123     3187 2023-04-09 14:29:04.000000 strkit_rust_ext-0.2.1/.github/workflows/build-release.yml
+-rw-r--r--   0     1001      123      685 2023-04-09 14:29:04.000000 strkit_rust_ext-0.2.1/.gitignore
+-rw-r--r--   0     1001      123    35149 2023-04-09 14:29:04.000000 strkit_rust_ext-0.2.1/LICENSE
+-rw-r--r--   0     1001      123      328 2023-04-09 14:29:04.000000 strkit_rust_ext-0.2.1/README.md
+-rw-r--r--   0     1001      123      377 2023-04-09 14:29:04.000000 strkit_rust_ext-0.2.1/pyproject.toml
+-rw-r--r--   0     1001      123     1172 2023-04-09 14:29:04.000000 strkit_rust_ext-0.2.1/src/lib.rs
+-rw-r--r--   0     1001      123      300 2023-04-09 14:29:04.000000 strkit_rust_ext-0.2.1/strkit_rust_ext.pyi
+-rw-r--r--   0     1001      123      636 2023-04-09 14:29:04.000000 strkit_rust_ext-0.2.1/tests/test_snvs.py
+-rw-r--r--   0     1001      123     7659 2023-04-09 14:29:04.000000 strkit_rust_ext-0.2.1/Cargo.lock
+-rw-r--r--   0        0        0      684 1970-01-01 00:00:00.000000 strkit_rust_ext-0.2.1/PKG-INFO
```

### Comparing `strkit_rust_ext-0.1.0/.github/workflows/build-release.yml` & `strkit_rust_ext-0.2.1/.github/workflows/build-release.yml`

 * *Files 22% similar despite different names*

```diff
@@ -1,30 +1,44 @@
-# This file is autogenerated by maturin v0.14.16
-# To update, run
-#
-#    maturin init
-#
 on:
   release:
     types: [published]
   push:
     branches:
       - main
   pull_request:
   workflow_dispatch:
 
 permissions:
   contents: read
 
 jobs:
+  test:
+    runs-on: ubuntu-latest
+    strategy:
+      matrix:
+        target: [x86_64, x86, aarch64, armv7]
+    steps:
+      - uses: actions/checkout@v3
+      - uses: actions/setup-python@v4
+        with:
+          python-version: '3.10'
+      - name: Run tests
+        run: |
+          python -m venv env
+          source env/bin/activate
+          pip install maturin pytest
+          python -m maturin develop
+          pytest
+      
   linux:
     runs-on: ubuntu-latest
+    needs: [test]
     strategy:
       matrix:
-        target: [x86_64, x86, aarch64, armv7, s390x, ppc64le]
+        target: [x86_64, x86, aarch64, armv7]
     steps:
       - uses: actions/checkout@v3
       - uses: actions/setup-python@v4
         with:
           python-version: '3.10'
       - name: Build wheels
         uses: PyO3/maturin-action@v1
@@ -37,14 +51,15 @@
         uses: actions/upload-artifact@v3
         with:
           name: wheels
           path: dist
 
   windows:
     runs-on: windows-latest
+    needs: [test]
     strategy:
       matrix:
         target: [x64, x86]
     steps:
       - uses: actions/checkout@v3
       - uses: actions/setup-python@v4
         with:
@@ -60,14 +75,15 @@
         uses: actions/upload-artifact@v3
         with:
           name: wheels
           path: dist
 
   macos:
     runs-on: macos-latest
+    needs: [test]
     strategy:
       matrix:
         target: [x86_64, aarch64]
     steps:
       - uses: actions/checkout@v3
       - uses: actions/setup-python@v4
         with:
@@ -82,14 +98,15 @@
         uses: actions/upload-artifact@v3
         with:
           name: wheels
           path: dist
 
   sdist:
     runs-on: ubuntu-latest
+    needs: [test]
     steps:
       - uses: actions/checkout@v3
       - name: Build sdist
         uses: PyO3/maturin-action@v1
         with:
           command: sdist
           args: --out dist
```

### Comparing `strkit_rust_ext-0.1.0/.gitignore` & `strkit_rust_ext-0.2.1/.gitignore`

 * *Files identical despite different names*

### Comparing `strkit_rust_ext-0.1.0/LICENSE` & `strkit_rust_ext-0.2.1/LICENSE`

 * *Files identical despite different names*

### Comparing `strkit_rust_ext-0.1.0/src/lib.rs` & `strkit_rust_ext-0.2.1/src/lib.rs`

 * *Files 24% similar despite different names*

```diff
@@ -1,39 +1,21 @@
 use pyo3::prelude::*;
-use pyo3::types::PyDict;
 use std::collections::HashMap;
 
 #[pyfunction]
-fn mk_snvs_dict<'a>(
-    py: Python<'a>,
-    query_sequence: &str,
-    pairs: Vec<(usize, usize)>,
-    ref_seq: &str,
-    ref_coord_start: usize,
-    tr_start_pos: usize,
-    tr_end_pos: usize,
-) -> PyResult<&'a PyDict> {
-    let qry_seq_bytes = query_sequence.as_bytes();
-    let ref_seq_bytes = ref_seq.as_bytes();
-
-    let out = PyDict::new(py);
-
-    for (read_pos, ref_pos) in pairs {
-        if !(tr_start_pos <= ref_pos && ref_pos < tr_end_pos)
-            && (qry_seq_bytes[read_pos] != ref_seq_bytes[ref_pos - ref_coord_start])
-        {
-            out.set_item(ref_pos, qry_seq_bytes[read_pos] as char)?;
-        }
-    }
-
-    Ok(out)
+fn find_pair_by_ref_pos(pairs: Vec<(usize, usize)>, target: usize) -> (usize, bool) {
+    let res = &pairs[..].binary_search_by_key(&target, |&(_qc, rc)| rc);
+    return match *res {
+        Ok(i)  => (i, true),
+        Err(i) => (i, false),
+    };
 }
 
 #[pyfunction]
-fn mk_snvs_hash(
+fn get_snvs_simple(
     query_sequence: &str,
     pairs: Vec<(usize, usize)>,
     ref_seq: &str,
     ref_coord_start: usize,
     tr_start_pos: usize,
     tr_end_pos: usize,
 ) -> HashMap<usize, char> {
@@ -48,11 +30,11 @@
                 .then(|| (ref_pos, qry_seq_bytes[read_pos] as char))
         })
         .collect()
 }
 
 #[pymodule]
 fn strkit_rust_ext(_py: Python, m: &PyModule) -> PyResult<()> {
-    m.add_function(wrap_pyfunction!(mk_snvs_dict, m)?)?;
-    m.add_function(wrap_pyfunction!(mk_snvs_hash, m)?)?;
+    m.add_function(wrap_pyfunction!(find_pair_by_ref_pos, m)?)?;
+    m.add_function(wrap_pyfunction!(get_snvs_simple, m)?)?;
     Ok(())
 }
```

### Comparing `strkit_rust_ext-0.1.0/Cargo.lock` & `strkit_rust_ext-0.2.1/Cargo.lock`

 * *Files 1% similar despite different names*

```diff
@@ -177,15 +177,15 @@
 name = "smallvec"
 version = "1.10.0"
 source = "registry+https://github.com/rust-lang/crates.io-index"
 checksum = "a507befe795404456341dfab10cef66ead4c041f62b8b11bbb92bffe5d0953e0"
 
 [[package]]
 name = "strkit_rust_ext"
-version = "0.1.0"
+version = "0.2.1"
 dependencies = [
  "pyo3",
 ]
 
 [[package]]
 name = "syn"
 version = "1.0.109"
```

### Comparing `strkit_rust_ext-0.1.0/PKG-INFO` & `strkit_rust_ext-0.2.1/PKG-INFO`

 * *Files 16% similar despite different names*

```diff
@@ -1,17 +1,26 @@
 Metadata-Version: 2.1
 Name: strkit_rust_ext
-Version: 0.1.0
+Version: 0.2.1
 Classifier: Programming Language :: Rust
 Classifier: Programming Language :: Python :: Implementation :: CPython
 Classifier: Programming Language :: Python :: Implementation :: PyPy
 License-File: LICENSE
 Requires-Python: >=3.9
 Description-Content-Type: text/markdown; charset=UTF-8; variant=GFM
 
 # STRkit Rust extension
 
 Extension for STRKit with components written in Rust, for improved performance.
 
 &copy; the contributors of the STRkit Rust extension 2023. Licensed under
 the terms of the [GNU General Public License, v3.0](./LICENSE).
 
+
+## Testing locally
+
+```bash
+pip install maturin pytest
+maturin develop
+pytest
+```
+
```

